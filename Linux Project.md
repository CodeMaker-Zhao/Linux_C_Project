## Linux Project

Linux与C课程作业

### 构建与运行

```shell
make
cd bin
./producer
./saler
./consumer
```



### 基本介绍

项目流程图（彩色部分为IPC相关）如下

![Linux_project](./img/Linux_project.png)

此项目中生产者与售货员之间通过信号量传递面包生产情况，售货员和消费者之间通过消息队列的形式传递消费请求，并且售货员会将线程数写入共享内存当中，消费者消费时可以通过共享内存拿到这个值，用来初始化等待人数上限（3倍的线程数），消费者每次消费时，会先检测消息队列的消息数，这个数值可以等同于等待者人数，如果这个数大于上限，则直接退出，否则进入等待，通过信号量来控制相同时间内最多服务的线程数。

在/etc/rc.d/init.d下添加脚本将生产者服务作为开机自启动项，注册producer服务。

### 截图记录

下图是实际运行时截图。

生产者开始生产，到200停止生产。

![截屏2021-12-15 下午9.25.42](./img/1.png)



消费者开始消费，saler.log记录下了售卖情况。

![截屏2021-12-15 下午9.27.04](./img/2.png)

当消费者将200个面包消费完之后，生产者重新开始生产。

![截屏2021-12-15 下午9.27.53](./img/3.png)

同样也是生产到200个之后停止生产。

![截屏2021-12-15 下午9.28.00](./img/4.png)